"use strict";var AreaModel=function(){this.label;this.centerName;this.center;this.trash=new Array();this.calcMostRect=function(){for(var a=0;a<this.trash.length;a++){this.trash[a].calcMostRect(this)}};this.isBlankDay=function(a){var b=[this.center.startDate,this.center.endDate];if(b[0].getTime()<=a.getTime()&&a.getTime()<=b[1].getTime()){return true}return false};this.setCenter=function(b){for(var a in b){if(this.centerName==b[a].name){this.center=b[a]}}};this.sortTrash=function(){this.trash.sort(function(e,d){var c=e.mostRecent.getTime();var f=d.mostRecent.getTime();if(c<f){return -1}if(c>f){return 1}return 0})}};var Description=function(){this.label;this.notice};var TrashModel=function(e,g){this.dayLabel;this.mostRecent;this.dayList;this.dayCell=g.split(" ");this.label=e;this.description;var f="";var c=new Date();for(var d in this.dayCell){if(this.dayCell[d].length==1){f+="毎週"+this.dayCell[d]+"曜日 "}else{f+="第"+this.dayCell[d].charAt(1)+this.dayCell[d].charAt(0)+"曜日 "}}this.dayLabel=f;this.getDateLabel=function(){var h=this.mostRecent.getFullYear()+"/"+(1+this.mostRecent.getMonth())+"/"+this.mostRecent.getDate();return this.dayLabel+" "+h};var b=["日","月","火","水","木","金","土"];function a(j){for(var h=0;h<b.length;h++){if(b[h]==j){return h}}return -1}this.calcMostRect=function(u){var s=this.dayCell;var n="";var h=new Array();for(var r=4;r<=12+3;r++){for(var p in s){var k=false;for(var m=0;m<5;m++){var o=new Date(2013,r-1,1);var t=new Date(o);t.setTime(o.getTime()+1000*60*60*24*((7+a(s[p].charAt(0))-o.getDay())%7)+m*7*24*60*60*1000);if(u.isBlankDay(t)){k=true}if(k){t.setTime(t.getTime()+7*24*60*60*1000)}if(t.getMonth()!=(r-1)%12){continue}if(s[p].length>1){if(m!=s[p].charAt(1)-1){continue}}h.push(t)}}}h.sort(function(v,j){var i=v.getTime();var w=j.getTime();if(i<w){return -1}if(i>w){return 1}return 0});var l=new Date();for(var q in h){if(this.mostRecent==null&&l.getTime()<h[q].getTime()+24*60*60*1000){this.mostRecent=h[q];break}}this.dayList=h};this.getDayList=function(){var h="<ul>";for(var j in this.dayList){var k=this.dayList[j];h+="<li>"+k.getFullYear()+"/"+(k.getMonth()+1)+"/"+k.getDate()+"</li>"}h+="</ul>";return h}};var CenterModel=function(b){function a(c,d){var e=c[d].split("/");return new Date(e[0],e[1]-1,e[2])}this.name=b[0];this.startDate=a(b,1);this.endDate=a(b,2)};$(function(){var b=new Array();var f=new Array();var k=new Array();function j(){return localStorage.getItem("selected_area_name")}function c(l){localStorage.setItem("selected_area_name",l)}function a(){$.get("data/area_days.csv",function(l){var l=l.replace("/\r/gm","");var o=l.split(String.fromCharCode(10));var r=o.shift().split(",");for(var n in o){var q=o[n].split(",");var p=new AreaModel();p.label=q[0];p.centerName=q[1];k.push(p);for(var n=2;n<2+4;n++){var m=new TrashModel(r[n],q[n]);p.trash.push(m)}}$.get("data/center.csv",function(C){var w=C.split(String.fromCharCode(10));for(var x in w){var D=w[x].split(",");var s=new CenterModel(D);b.push(s)}for(var x in k){var t=k[x];t.setCenter(b)}var B=j();var u=$("#select_area");var z="";z+='<option value="-1">地域を選択してください</option>';for(var y in k){var A=k[y].label;var v=(B==A)?'selected="selected"':"";z+='<option value="'+y+'" '+v+" >"+A+"</option>"}if(typeof dump=="function"){dump(k)}u.html(z);u.change()})})}function i(l){$.getJSON("data/description.json",function(n){for(var m in n){f.push(n[m])}l();$("#accordion2").show()})}function g(s){var m=(window.SVGAngle!==void 0);var B=k[s];var A=new Date();B.calcMostRect();B.sortTrash();var z=$(window).height()/4;var l="";for(var y in B.trash){var w;var p=B.trash[y];for(var t in f){if(f[t].label==p.label){w=f[t];var r="";var n="";var r="";var C=w.target;for(var x in C){var D=C[x];if(n!=D.furigana){if(n!=""){r+="</ul>"}n=D.furigana;r+='<h4 class="initials">'+n+"</h4>";r+="<ul>"}r+="<li>"+D.name+"</li>"}r+="</ul>";var u=p.getDateLabel();var o=Math.ceil((p.mostRecent.getTime()-A.getTime())/(1000*60*60*24));var q="";if(o==0){q="今日"}else{if(o==1){q="明日"}else{if(o==2){q="明後日"}else{q=o+"日後"}}}l+='<div class="accordion-group" id="accordion-group'+t+'"><div class="accordion-heading"><a class="accordion-toggle" style="height:'+z+'px" data-toggle="collapse" data-parent="#accordion" href="#collapse'+y+'"><div class="left-day">'+q+'</div><div class="accordion-table" >';if(m){l+='<img src="'+w.styles.svg+'" alt="'+w.label+'"  />'}else{l+='<p class="text-center">'+w.label+"</p>"}l+='</div><h6><p class="text-left date">'+u+'</p></h6></a></div><div id="collapse'+y+'" class="accordion-body collapse"><div class="accordion-inner">'+w.description+"<br />"+r+'<div class="targetDays"></div></div></div></div>'}}}var v=$("#accordion");v.html(l);$(".accordion-body").on("shown.bs.collapse",function(){var E=$("body");var F=$($(this).parent().get(0)).offset().top;E.animate({scrollTop:F},50)});$(".accordion-body").on("hidden.bs.collapse",function(){if($(".in").length==0){$("html, body").scrollTop(0)}})}function d(l){if(l==-1){return}c(k[l].label);if($("#accordion").children().length==0){i(function(){g(l)})}else{g(l)}}function e(l){switch(l.code){case l.PERMISSION_DENIED:return"User denied the request for Geolocation.";case l.POSITION_UNAVAILABLE:return"Location information is unavailable.";case l.TIMEOUT:return"The request to get user location timed out.";case l.UNKNOWN_ERROR:default:return"An unknown error occurred."}}function h(m){for(var l in k){if(k[l].label==m){return l}}return -1}$("#select_area").change(function(m){var l=$(m.target).val();d(l)});$("#gps_area").click(function(){navigator.geolocation.getCurrentPosition(function(l){$.getJSON("area_candidate.php",{latitude:l.coords.latitude,longitude:l.coords.longitude},function(o){if(o.result==true){var n=o.candidate;var m=h(n);$("#select_area").val(m).change();alert(n+"が設定されました")}else{alert(o.reason)}})},function(l){alert(e(l))})});if(j()==null){$("#accordion2").show();$("#collapseZero").addClass("in")}if(!navigator.geolocation){$("#gps_area").css("display","none")}a()});